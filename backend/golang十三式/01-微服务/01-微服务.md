## 概述

    微服务概览
    微服务设计
    gRPC & 服务发现
    多集群 & 多租户


## 微服务概览

### 单体架构 & 微服务起源

- SOA（面向服务）架构模式：微服务是SOA的一种实践

    原子服务：关注单一业务，服务间采用轻量级的通信机制
    独立进程，链路追踪
    隔离部署
    去中心化服务治理



- 微服务不足

batch批请求：一个用户评论列表，需要获取很多用户信息，若单个独自发送rpc请求，会将原始请求放大百倍

并行请求：a接口依赖b接口，b接口依赖c接口，请求依赖嵌套

    数据一致性问题
    多测试环境问题
    模块依赖升级问题

### 组件服务化（类似于DDD）

本质上等同于，多个微服务组合完成一个完整的用户场景

    kit：一个微服务的基础库
    service：业务代码 + kit依赖+第三方依赖组成的业务微服务
    rpc + message queue：轻量级通讯


### 按业务组织服务(工作模式)

【康威定律】

you build it,you fix it

大前端（移动/web）=> 网关团队=> 业务服务 => 平台服务 => 基础设施（PaaS/SaaS）

### 去中心化


    数据去中心化（服务独占缓存、数据库）
    治理去中心化（流量变大之后，流量热点问题）
    技术去中心化


### 基础设施自动化


    CICD：gitlab + gitlab hooks + k8s
    Testing: 测试环境，单元测试，API自动化测试（yapi）
    在线运行时：k8s，prometheus，ELK


### 可用性 & 兼容性设计（design for failure思想，粗粒度京城间通信（batch））

    隔离
    超时控制
    负载保护
    限流
    降级
    重试
    负载均衡

【伯斯塔尔法则】






