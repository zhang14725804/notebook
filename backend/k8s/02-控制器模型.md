### 控制器模型

1. Pod 这个看似复杂的 API 对象，实际上就是对容器的进一步抽象和封装而已。
2. kube-controller-manager
3. 控制循环
4. PodTemplate（定义被控制对象）

### Kubernetes 使用的这个“控制器模式”，跟我们平常所说的“事件驱动”，有什么区别和联系吗？

1. 答案1

相当于select和epoll的区别： select,poll,epoll本质上都是同步I/O，都是IO多路复用的机制，即通过一种机制可以监视多个描述符，一旦某个描述符就绪，就能通知程序进行相应的读写操作。

- select时间复杂度是O(n):仅仅知道有IO事件发生，只能无差别轮询所有流，循环访问，找出能读或者写入的流 
- poll复杂度也是O(n)和select没有区别，但由于他是基于链表来存储的，因此没有最大连接数的限制。 
- epoll可以理解为event poll，会得知哪个具体的流发生了IO事件（复杂度降到了o(1))

2. 答案2

“事件驱动”，对于控制器来说是被动，只要触发事件则执行，对执行后不负责，无论成功与否，没有对一次操作的后续进行“监控”
“控制器模式”，对于控制器来说是主动的，自身在不断地获取信息，起到事后“监控”作用，知道同步完成，实际状态与期望状态一致

3. 答案3

事件往往是一次性的，如果操作失败比较难处理，但是控制器是循环一直在尝试的，更符合kubernetes申明式API，最终达到与申明一致


### 作业副本与水平扩展

1. ReplicaSet
2. 对于一个 Deployment 所管理的 Pod，它的 ownerReference 是谁？ReplicaSet
3. deployment状态: 【DESIRED】、【CURRENT】、【UP-TO-DATE】、【AVAILABLE】
4. Deployment 实际上是一个两层控制器。首先，它通过 ReplicaSet 的个数来描述应用的版本；然后，它再通过 ReplicaSet 的属性（比如 replicas 的值），来保证 Pod 的副本数量
5. 金丝雀部署和蓝绿部署

- 金丝雀部署：优先发布一台或少量机器升级，等验证无误后再更新其他机器。优点是用户影响范围小，不足之处是要额外控制如何做自动更新。
- 蓝绿部署：2组机器，蓝代表当前的V1版本，绿代表已经升级完成的V2版本。通过LB将流量全部导入V2完成升级部署。优点是切换快速，缺点是影响全部用户。