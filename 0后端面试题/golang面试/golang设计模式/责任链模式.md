## è´£ä»»é“¾æ¨¡å¼

### 1.è´£ä»»é“¾æ¨¡å¼æ¦‚å¿µ

    é¦–å…ˆæŠŠä¸€ç³»åˆ—ä¸šåŠ¡æŒ‰èŒè´£åˆ’åˆ†æˆä¸åŒçš„å¯¹è±¡ï¼Œæ¥ç€æŠŠè¿™ä¸€ç³»åˆ—å¯¹è±¡æ„æˆä¸€ä¸ªé“¾ï¼Œç„¶ååœ¨è¿™ä¸€ç³»åˆ—å¯¹è±¡ä¸­ä¼ é€’è¯·æ±‚å¯¹è±¡ï¼Œç›´åˆ°è¢«å¤„ç†ä¸ºæ­¢(ç»“æŸï¼šå¼‚å¸¸ç»“æŸï¼Œæˆ–é“¾è·¯æ‰§è¡Œå®Œæ¯•ç»“æŸ)ã€‚

### 2.ä½¿ç”¨åœºæ™¯

æ¯”å¦‚ç”µå•†ç³»ç»Ÿçš„ä¸‹å•æ¥å£ï¼Œéšç€ä¸šåŠ¡å‘å±•ä¸æ–­çš„å‘å±•ï¼Œè¯¥æ¥å£ä¼šå……æ–¥ç€å„ç§å„æ ·çš„ä¸šåŠ¡é€»è¾‘

### 3.å¦‚ä½•ä½¿ç”¨èŒè´£é“¾æ¨¡å¼

    ä¸šåŠ¡æ¢³ç†
    ä¸šåŠ¡æµç¨‹å›¾
    ä»£ç å»ºæ¨¡
    ä»£ç 

- ä¸šåŠ¡æ¢³ç†

å‚æ•°æ ¡éªŒ --> è·å–åœ°å€ä¿¡æ¯ --> åœ°å€ä¿¡æ¯æ ¡éªŒ-->è·å–è´­ç‰©è½¦æ•°æ®-->	è·å–å•†å“åº“å­˜ä¿¡æ¯-->	å•†å“åº“å­˜æ ¡éªŒ
-->	è·å–ä¼˜æƒ ä¿¡æ¯-->	è·å–è¿è´¹ä¿¡æ¯-->	ä½¿ç”¨ä¼˜æƒ ä¿¡æ¯-->	æ‰£åº“å­˜-->	æ¸…ç†è´­ç‰©è½¦-->	å†™è®¢å•è¡¨-->	å†™è®¢å•å•†å“è¡¨-->	å†™è®¢å•ä¼˜æƒ ä¿¡æ¯è¡¨-->	ä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘...

- ä»£ç å»ºæ¨¡

è´£ä»»é“¾æ¨¡å¼ä¸»è¦ç±»ä¸»è¦åŒ…å«å¦‚ä¸‹ç‰¹æ€§ï¼š

ï¼ˆ1ï¼‰æˆå‘˜å±æ€§

    nextHandler: ä¸‹ä¸€ä¸ªç­‰å¾…è¢«è°ƒç”¨çš„å¯¹è±¡å®ä¾‹ -> ç¨³å®šä¸å˜çš„

ï¼ˆ2ï¼‰æˆå‘˜æ–¹æ³•

    SetNext: æŠŠä¸‹ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ç»‘å®šåˆ°å½“å‰å¯¹è±¡çš„nextHandlerå±æ€§ä¸Š -> ç¨³å®šä¸å˜çš„
    Do: å½“å‰å¯¹è±¡ä¸šåŠ¡é€»è¾‘å…¥å£ -> å˜åŒ–çš„
    Run: è°ƒç”¨å½“å‰å¯¹è±¡çš„Doï¼ŒnextHandlerä¸ä¸ºç©ºåˆ™è°ƒç”¨nextHandler.Do -> ç¨³å®šä¸å˜çš„

å¥—ç”¨åˆ°ä¸‹å•æ¥å£ä¼ªä»£ç å®ç°å¦‚ä¸‹ï¼š

    ä¸€ä¸ªçˆ¶ç±»(æŠ½è±¡ç±»)ï¼š

    - æˆå‘˜å±æ€§
        + `nextHandler`: ä¸‹ä¸€ä¸ªç­‰å¾…è¢«è°ƒç”¨çš„å¯¹è±¡å®ä¾‹
    - æˆå‘˜æ–¹æ³•
        + å®ä½“æ–¹æ³•`SetNext`: å®ç°æŠŠä¸‹ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ç»‘å®šåˆ°å½“å‰å¯¹è±¡çš„`nextHandler`å±æ€§ä¸Š
        + æŠ½è±¡æ–¹æ³•`Do`: å½“å‰å¯¹è±¡ä¸šåŠ¡é€»è¾‘å…¥å£
        + å®ä½“æ–¹æ³•`Run`: å®ç°è°ƒç”¨å½“å‰å¯¹è±¡çš„`Do`ï¼Œ`nextHandler`ä¸ä¸ºç©ºåˆ™è°ƒç”¨`nextHandler.Do`

    å­ç±»ä¸€(å‚æ•°æ ¡éªŒ)
    - ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»
    - å®ç°æŠ½è±¡æ–¹æ³•`Do`ï¼šå…·ä½“çš„å‚æ•°æ ¡éªŒé€»è¾‘

    å­ç±»äºŒ(è·å–åœ°å€ä¿¡æ¯)
    - ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»
    - å®ç°æŠ½è±¡æ–¹æ³•`Do`ï¼šå…·ä½“è·å–åœ°å€ä¿¡æ¯çš„é€»è¾‘

    å­ç±»ä¸‰(è·å–è´­ç‰©è½¦æ•°æ®)
    - ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»
    - å®ç°æŠ½è±¡æ–¹æ³•`Do`ï¼šå…·ä½“è·å–è´­ç‰©è½¦æ•°æ®çš„é€»è¾‘

    ......ç•¥

    å­ç±»X(ä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘)
    - ç»§æ‰¿æŠ½è±¡ç±»çˆ¶ç±»
    - å®ç°æŠ½è±¡æ–¹æ³•`Do`ï¼šä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘

    
ä½†æ˜¯ï¼Œgolangé‡Œæ²¡æœ‰çš„ç»§æ‰¿çš„æ¦‚å¿µï¼Œè¦å¤ç”¨æˆå‘˜å±æ€§nextHandlerã€æˆå‘˜æ–¹æ³•SetNextã€æˆå‘˜æ–¹æ³•Runæ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬ä½¿ç”¨åˆæˆå¤ç”¨çš„ç‰¹æ€§å˜ç›¸è¾¾åˆ°â€œç»§æ‰¿å¤ç”¨â€çš„ç›®çš„ï¼Œå¦‚ä¸‹ï¼š

    ä¸€ä¸ªæ¥å£(interface)ï¼š

    - æŠ½è±¡æ–¹æ³•`SetNext`: å¾…å®ç°æŠŠä¸‹ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ç»‘å®šåˆ°å½“å‰å¯¹è±¡çš„`nextHandler`å±æ€§ä¸Š
    - æŠ½è±¡æ–¹æ³•`Do`: å¾…å®ç°å½“å‰å¯¹è±¡ä¸šåŠ¡é€»è¾‘å…¥å£
    - æŠ½è±¡æ–¹æ³•`Run`: å¾…å®ç°è°ƒç”¨å½“å‰å¯¹è±¡çš„`Do`ï¼Œ`nextHandler`ä¸ä¸ºç©ºåˆ™è°ƒç”¨`nextHandler.Do`

    ä¸€ä¸ªåŸºç¡€ç»“æ„ä½“ï¼š

    - æˆå‘˜å±æ€§
        + `nextHandler`: ä¸‹ä¸€ä¸ªç­‰å¾…è¢«è°ƒç”¨çš„å¯¹è±¡å®ä¾‹
    - æˆå‘˜æ–¹æ³•
        + å®ä½“æ–¹æ³•`SetNext`: å®ç°æŠŠä¸‹ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ç»‘å®šåˆ°å½“å‰å¯¹è±¡çš„`nextHandler`å±æ€§ä¸Š
        + å®ä½“æ–¹æ³•`Run`: å®ç°è°ƒç”¨å½“å‰å¯¹è±¡çš„`Do`ï¼Œ`nextHandler`ä¸ä¸ºç©ºåˆ™è°ƒç”¨`nextHandler.Do`

    å­ç±»ä¸€(å‚æ•°æ ¡éªŒ)
    - åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“
    - å®ç°æŠ½è±¡æ–¹æ³•`Do`ï¼šå…·ä½“çš„å‚æ•°æ ¡éªŒé€»è¾‘

    å­ç±»äºŒ(è·å–åœ°å€ä¿¡æ¯)
    - åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“
    - å®ç°æŠ½è±¡æ–¹æ³•`Do`ï¼šå…·ä½“è·å–åœ°å€ä¿¡æ¯çš„é€»è¾‘

    å­ç±»ä¸‰(è·å–è´­ç‰©è½¦æ•°æ®)
    - åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“
    - å®ç°æŠ½è±¡æ–¹æ³•`Do`ï¼šå…·ä½“è·å–è´­ç‰©è½¦æ•°æ®çš„é€»è¾‘

    ......ç•¥

    å­ç±»X(ä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘)
    - åˆæˆå¤ç”¨åŸºç¡€ç»“æ„ä½“
    - å®ç°æŠ½è±¡æ–¹æ³•`Do`ï¼šä»¥åŠæœªæ¥ä¼šå¢åŠ çš„é€»è¾‘


```golang

type Context struct{}
// æ²¡å¤ªæ‡‚ï¼Œå¦‚ä½•å®ç°çš„é“¾å¼è°ƒç”¨ï¼ˆquestionï¼‰
type Handler interface {
	// è‡ªèº«ä¸šåŠ¡
	Do(ctx *Context) error
	// è®¾ç½®ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å¯¹è±¡
	SetNext(h Handler) Handler
	// æ‰§è¡Œ å®ç°è°ƒç”¨å½“å‰å¯¹è±¡çš„`Do`ï¼Œ`nextHandler`ä¸ä¸ºç©ºåˆ™è°ƒç”¨`nextHandler.Do`
	Run(ctx *Context) error
}

// æˆå‘˜å±æ€§ï¼›æŠ½è±¡å‡ºæ¥çš„ï¼Œå¯è¢«åˆæˆå¤ç”¨çš„ç»“æ„ä½“ï¼ˆquestionğŸ˜…ï¼‰
type Next struct {
	nextHandler Handler //
}

// æˆå‘˜æ–¹æ³•ï¼›å¯è¢«å¤ç”¨çš„setNextæ–¹æ³•ï¼Œè¿”å›ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼›
func (n *Next) SetNext(h Handler) Handler {
	n.nextHandler = h
	return h
}

// æˆå‘˜æ–¹æ³•ï¼ˆquestionï¼Œé“¾å¼è°ƒç”¨ä¸åº”è¯¥è¿”å›å¯¹è±¡ä¹ˆï¼‰ï¼›å®ç°è°ƒç”¨å½“å‰å¯¹è±¡çš„`Do`ï¼Œ`nextHandler`ä¸ä¸ºç©ºåˆ™è°ƒç”¨`nextHandler.Do`
func (n *Next) Run(c *Context) (err error) {
	// ç”±äºgoæ— ç»§æ‰¿çš„æ¦‚å¿µï¼Œè¿™é‡Œæ— æ³•æ‰§è¡Œå½“å‰handlerçš„Do
	if n.nextHandler != nil {
		// æ‰§è¡Œä¸‹ä¸€ä¸ªhandler
		if err = (n.nextHandler).Do(c); err != nil {
			return
		}
		return (n.nextHandler).Run(c)
	}
	return
}

// ç”±äºgoæ— ç»§æ‰¿çš„æ¦‚å¿µï¼Œä½œä¸ºé“¾å¼è°ƒç”¨çš„ç¬¬ä¸€ä¸ªè½½ä½“ï¼Œè®¾ç½®å®é™…çš„ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼›ï¼ˆNilHandlerä»€ä¹ˆä½œç”¨questionğŸ˜…ï¼‰
type NilHandler struct {
	// åˆæˆå¤ç”¨Nextçš„nextHandleræˆå‘˜å±æ€§ï¼ŒsetNextã€Runæˆå‘˜æ–¹æ³•
	Next
}

// ï¼ˆquestionğŸ˜…ï¼‰
func (h *NilHandler) Do(c *Context) (err error) {
	// ç©ºhandlerï¼Œä»€ä¹ˆä¹Ÿä¸åšï¼Œåªæ˜¯è½½ä½“ ï¼ˆä»€ä¹ˆä½œç”¨questionğŸ˜…ï¼‰
	return
}

/* å…·ä½“ä¸šåŠ¡é€»è¾‘ */

// æ ¡éªŒå‚æ•°handler
type ArgumentHandler struct {
	// åˆæˆå¤ç”¨Nextçš„nextHandleræˆå‘˜å±æ€§ï¼ŒsetNextã€Runæˆå‘˜æ–¹æ³•
	Next
}

func (h *ArgumentHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "æ ¡éªŒå‚æ•°æˆåŠŸ...")
	return
}

// åœ°å€ä¿¡æ¯handler
type AddressHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

func (h *AddressHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "è·å–åœ°å€ä¿¡æ¯...\nåœ°å€ä¿¡æ¯æ ¡éªŒ...")
	return
}

// CartInfoHandler è·å–è´­ç‰©è½¦æ•°æ®handler
type CartInfoHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *CartInfoHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "è·å–è´­ç‰©è½¦æ•°æ®...")
	return
}

// StockInfoHandler å•†å“åº“å­˜handler
type StockInfoHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *StockInfoHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "è·å–å•†å“åº“å­˜ä¿¡æ¯...\nå•†å“åº“å­˜æ ¡éªŒ...")
	return
}

// PromotionInfoHandler è·å–ä¼˜æƒ ä¿¡æ¯handler
type PromotionInfoHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *PromotionInfoHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "è·å–ä¼˜æƒ ä¿¡æ¯...")
	return
}

// ShipmentInfoHandler è·å–è¿è´¹ä¿¡æ¯handler
type ShipmentInfoHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *ShipmentInfoHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "è·å–è¿è´¹ä¿¡æ¯...")
	return
}

// PromotionUseHandler ä½¿ç”¨ä¼˜æƒ ä¿¡æ¯handler
type PromotionUseHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *PromotionUseHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "ä½¿ç”¨ä¼˜æƒ ä¿¡æ¯...")
	return
}

// StockSubtractHandler åº“å­˜æ“ä½œhandler
type StockSubtractHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *StockSubtractHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "æ‰£åº“å­˜...")
	return
}

// CartDelHandler æ¸…ç†è´­ç‰©è½¦handler
type CartDelHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *CartDelHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "æ¸…ç†è´­ç‰©è½¦...")
	return
}

// DBTableOrderHandler å†™è®¢å•è¡¨handler
type DBTableOrderHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *DBTableOrderHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "å†™è®¢å•è¡¨...")
	return
}

// DBTableOrderSkusHandler å†™è®¢å•å•†å“è¡¨handler
type DBTableOrderSkusHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *DBTableOrderSkusHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "å†™è®¢å•å•†å“è¡¨...")
	return
}

// DBTableOrderPromotionsHandler å†™è®¢å•ä¼˜æƒ ä¿¡æ¯è¡¨handler
type DBTableOrderPromotionsHandler struct {
	// åˆæˆå¤ç”¨Next
	Next
}

// Do æ ¡éªŒå‚æ•°çš„é€»è¾‘
func (h *DBTableOrderPromotionsHandler) Do(c *Context) (err error) {
	fmt.Println(runFuncName(), "å†™è®¢å•ä¼˜æƒ ä¿¡æ¯è¡¨...")
	return
}

func main() {
	// åˆå§‹åŒ–ç©ºhandler ç›¸å½“ä¸é“¾è¡¨headèŠ‚ç‚¹ä¹ˆï¼ˆquestionï¼‰
	nilHandler := &NilHandler{}
	nilHandler.SetNext(&ArgumentHandler{}).
		SetNext(&AddressHandler{}).
		SetNext(&StockInfoHandler{}).
		SetNext(&PromotionInfoHandler{}).
		SetNext(&ShipmentInfoHandler{}).
		SetNext(&PromotionUseHandler{}).
		SetNext(&StockSubtractHandler{}).
		SetNext(&CartDelHandler{}).
		SetNext(&DBTableOrderHandler{}).
		SetNext(&DBTableOrderSkusHandler{}).
		SetNext(&DBTableOrderPromotionsHandler{})

	// å¼€å§‹æ‰§è¡Œä¸šåŠ¡
	if err := nilHandler.Run(&Context{}); err != nil {
		fmt.Println("Fail | error:" + err.Error())
		return
	}
	fmt.Println("Success!")
	return
}

func runFuncName() string {
	pc := make([]uintptr, 1)
	runtime.Callers(2, pc)
	f := runtime.FuncForPC(pc[0])
	return f.Name()
}
```
## ç»“è¯­
æœ€åæ€»ç»“ä¸‹ï¼Œã€Œè´£ä»»é“¾æ¨¡å¼(æ”¹)ã€æŠ½è±¡è¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯ï¼š

    æŒ‰èŒè´£åˆ’åˆ†ï¼šä¸šåŠ¡é€»è¾‘å½’ç±»ï¼Œæ”¶æ•›çš„è¿‡ç¨‹ã€‚
    å¯¹è±¡é“¾ï¼šæŠŠæ”¶æ•›ä¹‹åçš„ä¸šåŠ¡å¯¹è±¡æ„æˆå¯¹è±¡é“¾ï¼Œä¾æ¬¡è¢«æ‰§è¡Œã€‚