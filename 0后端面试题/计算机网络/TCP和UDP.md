## 传输层协议--TCP和UDP

    网络层：【主机】之间的通信
    传输层：【进程】之间的通信

### 1、UDP（User Datagram Protocol）用户数据协议报

（1）UDP优点

    （1）关于何时、发送什么数据的应用层控制更为精细（无拥塞控制）
    （2）无需连接建立（没有握手）（支持一对一、一对多、多对多）
    （3）无连接状态（无接收和发送缓存、拥塞控制参数、序号与确认号）
    （4）分组首部开销小（8字节）

（2）UDP首部（8字节）

    源端口
    目的端口
    UDP长度 （UDP首部和UDP数据的字节长度）
    检验和

UDP就是这么平平无奇

### 2、TCP（Transmission Control Protocol）传输控制协议

（1）TCP优点

    可靠
    面向连接（一对一）

（2）TCP首部

    源端口
    目的端口
    序号（字节流编号）
    确认号（期望收到的下一个报文段的序号）
    数据偏移（首部长度）
    ACK
    SYN
    FIN
    窗口

（3）如何唯一确定一个TCP连接

    源地址
    源端口
    目的地址
    目的端口

引申问题：**TCP最大连接数**

（4）三次握手、四次挥手

（5）

### 3、question

（1）为什么 UDP 头部没有「首部长度」字段，而 TCP 头部有「首部长度」字段呢？

原因是 TCP 有可变长的「选项」字段，而 UDP 头部长度则是不会变化的，无需多一个字段去记录 UDP 的首部长度。

（2）为什么 UDP 头部有「包长度」字段，而 TCP 头部则没有「包长度」字段呢？


（3）为什么是三次握手？不是两次、四次？

    三次握手才可以阻止历史重复连接的初始化（主要原因）
    三次握手才可以同步双方的初始序列号
    三次握手才可以避免资源浪费


    四次握手其实也能够可靠的同步双方的初始化序号，但由于第二步和第三步可以优化成一步，所以就成了「三次握手」

（4）既然 IP 层会分片，为什么 TCP 层还需要 MSS 呢？

    那么当如果一个 IP 分片丢失，整个 IP 报文的所有分片都得重传。

（5）为什么挥手需要四次？

- 关闭连接时，客户端向服务端发送 FIN 时，仅仅表示客户端不再发送数据了但是还能接收数据。

- 服务器收到客户端的 FIN 报文时，先回一个 ACK 应答报文，而服务端可能还有数据需要处理和发送，等服务端不再发送数据时，才发送 FIN 报文给客户端来表示同意现在关闭连接。

（6）为什么需要 TIME_WAIT 状态？

主动发起关闭连接的一方，才会有 TIME-WAIT 状态。

- 防止具有相同「四元组」的「旧」数据包被收到；

- 保证「被动关闭连接」的一方能被正确的关闭，即保证最后的 ACK 能让被动关闭方接收，从而帮助其正常关闭；



https://zhuanlan.zhihu.com/p/108822858
https://mp.weixin.qq.com/s/Tc09ovdNacOtnMOMeRc_uA
https://mp.weixin.qq.com/s/tH8RFmjrveOmgLvk9hmrkw