## gRPC和服务发现

### gRPC概述

服务间通讯：（1）http+nginx、（2）gRPC

gRPC优势：

    序列化方式：PB序列化（protocol buffers），json序列化
    IDL，文件定义服务
    基于HTTP2（http2.0、http1.1）
    设计理念

grpc和http区别

### gRPC healthCheck（主动健康监测）

平滑发布、平滑下线、外挂方式注册

平滑下线步骤（）：

    （1）服务发现注销
    （2）healthcheck 注销请求
    （3）等两个心跳周期，退出
    （4）超时强制退出

### 服务发现（复杂啊）

客户端发现模式、服务端发现模式（4层负载均衡（工作在IP层））



CAP理论

注册时间延迟，注销时间延迟

Uroca实现原理（复杂）

长轮询（长轮询和短轮询、长连接和短连接）

### 问题

    客户端多版本收敛问题
    微服务（分布式）数据一致性问题：**本地事物+消息队列**
    服务间调用环路问题：链路追踪
    API Gateway限流，网关无状态
    发送时要保守，接收时要开放
    某个服务挂了，如何处理。核心服务挂了直接500，其他服务挂了降级处理
    BFF之间不相互调用