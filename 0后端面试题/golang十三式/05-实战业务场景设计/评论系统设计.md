## 评论系统架构设计

    功能模块
    架构设计
    存储设计
    可用性设计

## 功能模块（【理解业务的本质】）

    发布评论：支持回复楼层、楼中楼（2层）
    读取评论：按照时间、热度、回复数排序
    删除评论：用户删除、作者删除
    管理评论：作者指定、后台运营管理（搜索、删除、审核）

## 架构设计

    （1）API网关
    （2）BFF(服务编排，平台功能)（其他BFF层：账号BFF、敏感词过滤BFF等）
    （3）Service 提供数据增删改查 
    （4）Job 写请求的瓶颈，有状态的这一层（各种数据库操作）。消息队列【错峰削峰】Kafka
    （5）Admin 和 Service 共享数据库。 ElasticSearch+Canel（解析MySQL bin_log😅）

**😅😅【联机事务处理OLTP】、【联机分析处理OLAP】**，MySQL索引基本原理。

**😅😅架构设计等同于数据设计，梳理清楚数据的走向和逻辑。尽量避免环形依赖、数据双向请求等。**

### comment-service

业务和功能耦合，不利于迭代

【读的核心逻辑】：读的瓶颈在cache。Cache-Aside，先读缓存，后读存储。rebuild cache，read ahead（预读），cache miss大量回源消息，Thundering herd现象

【写的核心逻辑】：写的瓶颈在状态层（MySQL）。引入Kafka【错峰削峰】，全局并行，局部串行。


56:12