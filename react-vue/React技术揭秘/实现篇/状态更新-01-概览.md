这一章我们看看几种常见的触发【状态更新】的方法是如何完成工作的

### 几个关键节点（几个关键函数调用）

- render阶段的开始

render阶段开始于performSyncWorkOnRoot或performConcurrentWorkOnRoot方法的调用。这取决于本次更新是同步更新还是异步更新

- commit阶段的开始

commit阶段开始于commitRoot方法的调用。其中rootFiber会作为传参。

【render阶段】完成后会进入【commit阶段】

- 创建Update对象

在React中，有如下方法可以触发状态更新（排除SSR相关）：

    ReactDOM.render
    this.setState
    this.forceUpdate
    useState
    useReducer

这些方法调用的场景各不相同，他们是如何接入同一套状态更新机制呢？

答案是：每次状态更新都会创建一个保存【更新状态相关内容】的对象，我们叫他【Update】。在render阶段的beginWork中会根据Update计算新的state。

- 从fiber到root

- 调度更新


### 状态更新流程

    （1）触发状态更新（根据场景调用不同方法）
    （2）创建Update对象
    （3）从fiber到root（`markUpdateLaneFromFiberToRoot`）
    （4）调度更新（`ensureRootIsScheduled`）
    （5）render阶段（`performSyncWorkOnRoot` 或 `performConcurrentWorkOnRoot`）
    （6）commit阶段（`commitRoot`）


### 同步更新的React

没有【优先级】概念，【高优更新】需要排在其他【更新】后面执行

在React中，所有通过ReactDOM.render创建的应用都是通过类似的方式更新状态。

### 并发更新的React

【高优更新】中断正在进行中的【低优更新】，先完成【render - commit】流程。

待【高优更新】完成后，【低优更新】基于【高优更新】的结果重新更新。

在React中，通过ReactDOM.createBlockingRoot和ReactDOM.createRoot创建的应用会采用【并发】的方式更新状态。